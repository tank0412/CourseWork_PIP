<ui:composition template="../templates/template.xhtml" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core" xmlns:rich="http://richfaces.org/rich"
                xmlns:a4j="http://richfaces.org/a4j">
    <ui:define name="head">
        <title>Chats</title>
        <script>
            window.onload=function () {
                var objDiv = document.getElementById("scrollbox");
                objDiv.scrollTop = 9999999999;
            }
        </script>
    </ui:define>
    <ui:define name="header">
        <ui:include src="../templates/header.xhtml"/>
    </ui:define>
    <ui:define name="content">
        <div class="d-flex container-fluid align-items-center flex-wrap align-self-center w-100">
        <div class="leftBlock m-2 align-self-start">
            <h:form id="form">
                <h:panelGrid columns="2" columnClasses="cols,cols" width="auto">
                    <rich:panelMenu styleClass="list" itemMode="ajax" groupMode="ajax" groupExpandedLeftIcon="triangleUp"
                                    groupCollapsedLeftIcon="triangleDown" topGroupExpandedRightIcon="chevronUp"
                                    topGroupCollapsedRightIcon="chevronDown" itemLeftIcon="disc" itemChangeListener="#{chatsBean.updateCurrent}" >
                        <p:remoteCommand name="upmsg" update="fmsg" />
                        <rich:panelMenuItem label="Global chat" name="1" />
                        <rich:panelMenuGroup label="Private">
                        <rich:list value="#{chatsBean.user.chats}" id="list" var="chat">
                            <rich:panelMenuItem label="${chat.name}" name="${chat.id}"/>
                        </rich:list>
                        </rich:panelMenuGroup>

                    </rich:panelMenu>
                </h:panelGrid>
            </h:form>

            <hr/>
            <button class="btn" type="button" data-toggle="collapse" data-target="#collapseCommands" aria-expanded="false" aria-controls="collapseCommands">
                commands
            </button>
            <div class="collapse" id="collapseCommands">
            <h:form>
                <h:panelGrid columns="1">
                    <p:outputLabel value="Create new chat"/>
                    <p:inputText value="#{chatsBean.chatName}" placeholder="chat name"/>
                    <p:commandButton value="Create" actionListener="#{chatsBean.createNewChat}"/>
                </h:panelGrid>
            </h:form>
            <h:form>
                <h:panelGrid columns="1">
                    <p:outputLabel value="Leave from chat"/>
                    <p:inputText value="#{chatsBean.chatId}" placeholder="chat id"/>
                    <p:commandButton value="Leave" actionListener="#{chatsBean.leaveFromChat}"/>
                </h:panelGrid>
            </h:form>
            <h:form>
                <h:panelGrid columns="1">
                    <p:outputLabel value="Invite user to chat"/>
                    <p:inputText value="#{chatsBean.userId}" placeholder="user id"/>
                    <p:commandButton value="Invite" actionListener="#{chatsBean.inviteUser}"/>
                </h:panelGrid>
            </h:form>
            </div>
        </div>
        <div class="centerBlock m-2 chat container-fluid align-self-stretch align-content-stretch w-75">
                <div class="fmsgbox h-75" id="scrollbox">
                <h:form id="fmsg">
                    <p:outputLabel value="Chat Id: #{chatsBean.current} : "/>
                    <p:outputLabel value="#{chatsBean.chat.name}"/>
                    <p:outputPanel styleClass="chatpanel">
                        <p:repeat value="#{chatsBean.ms}" var="message">
                            <h:outputText value="[#{message.time.toLocaleString()}] : "/>
                            <h:outputText value="#{message.sender.nickname} : "/>
                            <h:outputText value="#{message.message}"/>
                            <br/>
                        </p:repeat>
                    </p:outputPanel>
                </h:form>
                </div>
                <h:form styleClass="container-fluid m-2">
                    <p:inputTextarea styleClass="chatinput" rows="1" value="#{chatsBean.text}"/><br/>
                    <p:commandButton value="Send" actionListener="#{chatsBean.sendMessage}" wight="auto"/>
                </h:form>
            </div>
        </div>
    </ui:define>
    <ui:define name="footer">
        <ui:include src="../templates/footer.xhtml"/>
    </ui:define>
</ui:composition>
